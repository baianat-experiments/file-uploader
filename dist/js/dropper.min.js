var e,t;e=this,t=function(){"use strict";var t={folder:"M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z",file:"M13,9V3.5L18.5,9M6,2C4.89,2 4,2.89 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6Z"};function n(e){return document.createRange().createContextualFragment(e).firstElementChild}var r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),h=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,r=!1,s=void 0;try{for(var a,l=e[Symbol.iterator]();!(n=(a=l.next()).done)&&(i.push(a.value),!t||i.length!==t);n=!0);}catch(e){r=!0,s=e}finally{try{!n&&l.return&&l.return()}finally{if(r)throw s}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=function(){function f(e,t){var i;r(this,f),this.el="string"==typeof(i=e)?document.querySelector(i):i,this.settings=Object.assign({},f.defaults,t),this._init(),this._initEvents()}return e(f,[{key:"_init",value:function(){this.files=[],this.events={},this.input=n('<input type="file" class="dropper__input" />'),this.label=n('\n      <label class="dropper__label">\n        Drag & Drop your files or Browse\n      </label>'),this.filesWrapper=n('<div class="dropper__files"></div>'),this.settings.multiple&&(this.input.multiple=!0),this.el.appendChild(this.input),this.el.appendChild(this.label),this.el.appendChild(this.filesWrapper)}},{key:"_initEvents",value:function(){var t=this;["dragenter","dragover","dragleave","drop"].forEach(function(e){t.el.addEventListener(e,t.preventActions.bind(t),!1)}),["dragenter","dragover"].forEach(function(e){t.el.addEventListener(e,t.highlight.bind(t),!1)}),["dragleave","drop"].forEach(function(e){t.el.addEventListener(e,t.unhighlight.bind(t),!1)}),this.el.addEventListener("drop",this.handleDrop.bind(this),!1),this.el.addEventListener("click",function(){t.input.click()}),this.input.addEventListener("change",function(){return t.addFiles(t.input.files)},!1)}},{key:"preventActions",value:function(e){e.preventDefault(),e.stopPropagation()}},{key:"highlight",value:function(){this.form.classList.add("dropper__highlight")}},{key:"unhighlight",value:function(){this.form.classList.remove("dropper__highlight")}},{key:"handleDrop",value:function(e){var t=e.dataTransfer.files;this.addFiles(t)}},{key:"addFiles",value:function(e){var t=!0,i=!1,n=void 0;try{for(var r,s=e[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var a=r.value,l=(window.URL.createObjectURL(a),this.files.length),o=a.type.split("/"),d=h(o,2),u=d[0],p=d[1];this.files.push({file:a,type:u,ext:p,id:f.id++}),this.uploadFile(this.files[l]),this.previewFile(this.files[l])}}catch(e){i=!0,n=e}finally{try{!t&&s.return&&s.return()}finally{if(i)throw n}}this.input.value=""}},{key:"previewFile",value:function(e){var t=this,i=new FileReader;i.readAsDataURL(e.file),i.addEventListener("load",function(){e.name=e.file.name,e.size=function(e){if(0===e)return"0 Byte";var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,t),2)+" "+["Bytes","KB","MB","GB","TB"][t]}(e.file.size),e.path=i.result,e.isDirectory=!1,e.type=e.file.type.split("/")[0],e.progressBar=n('\n        <progress class="dropper-file__progress" max=100 value=0 id="progress__'+e.id+'"></progress>\n      '),t.createFile(e),e.el.appendChild(e.progressBar),e.el.addEventListener("click",function(e){return t.preventActions(e)}),t.filesWrapper.appendChild(e.el)})}},{key:"createFile",value:function(e){var t=this;return e.el=n('\n      <button href="#" type="button" class="dropper-file dropper-file--'+e.type+'">\n        <div class="dropper-file__info">\n          <span class="dropper-file__info-name">'+e.name+'</span>\n          <span class="dropper-file__info-size">'+e.size+"</span>\n        </div>\n        "+this.getFileIcon(e)+"\n      </button>\n    "),e.delete=n('\n      <a class="dropper-file__delete">\n        <svg class="dropper__icon" viewBox="0 0 24 24">\n          <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" />\n        </svg>\n      </a>\n    '),e.delete.addEventListener("click",function(){t.deleteFile(e)}),e.el.appendChild(e.delete),e.el}},{key:"getFileIcon",value:function(e){return"image"===e.type?'<img class="dropper-file__image" src="'+e.path+'"/>':'\n    <svg class="dropper-file__icon" viewBox="0 0 24 24">\n      <path d="'+t["file"]+'"/>\n    </svg>'}},{key:"uploadFile",value:function(t){var i=this,e=this.settings.url;if(e){var n=new XMLHttpRequest,r=new FormData;n.open("POST",e,!0),n.upload.addEventListener("progress",function(e){i.updateProgress(t.progressBar,100*e.loaded/e.total||100)}),n.addEventListener("readystatechange",function(e){4===n.readyState&&200===n.status&&i.emit("uploadSucceed",t),4===n.readyState&&200!==n.status&&i.emit("uploadFailed",t)}),r.append("file",t.file),n.send(r)}}},{key:"deleteFile",value:function(t){var i=this,e=this.settings.url;if(e){var n=new XMLHttpRequest,r=new FormData;n.open("DELETE",e+"/"+t.name,!0),n.addEventListener("readystatechange",function(e){4===n.readyState&&200===n.status&&i.emit("fileDeleted",t)}),t.el.remove(),this.files=this.files.filter(function(e){return e!==t}),r.append("file",t.file),n.send(r)}}},{key:"updateProgress",value:function(e,t){window.requestAnimationFrame(function(){100===(e.value=t)&&e.classList.add("dropper-file__progress--hidden")})}},{key:"on",value:function(e,t){var i=this;this.events[e]||(this.events[e]=[]);var n=this.events[e].length;return this.events[e].push(t),function(){i.events[e].splice(n,1)}}},{key:"emit",value:function(e,t){var i=this;this.events[e]&&this.events[e].length&&setTimeout(function(){i.events[e].forEach(function(e){return e(t)})},0)}}]),f}();return i.defaults={multiple:!0,url:null},i.id=0,i},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Dropper=t();