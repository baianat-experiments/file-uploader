var e,t;e=this,t=function(){"use strict";function n(e){return document.createRange().createContextualFragment(e).firstElementChild}var a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,a=!1,r=void 0;try{for(var s,l=e[Symbol.iterator]();!(n=(s=l.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){a=!0,r=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw r}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},t=function(){function o(e,t){var i;a(this,o),this.el="string"==typeof(i=e)?document.querySelector(i):i,this.settings=Object.assign({},o.defaults,t),this._init(),this._initEvents()}return e(o,[{key:"_init",value:function(){this.files=[],this.events={},this.wrapper=n('<form class="uploader"></form>'),this.label=n('\n      <label class="uploader__label" for="'+this.id+'">\n        Drag & Drop your files or Browse\n      </label>'),this.filesWrapper=n('<div class="uploader__files"></div>'),this.el.classList.add("uploader__input"),this.el.id=this.id,this.settings.multiple&&(this.el.multiple=!0),this.el.parentNode.insertBefore(this.wrapper,this.el),this.wrapper.appendChild(this.el),this.wrapper.appendChild(this.label),this.wrapper.appendChild(this.filesWrapper)}},{key:"_initEvents",value:function(){var t=this;["dragenter","dragover","dragleave","drop"].forEach(function(e){t.wrapper.addEventListener(e,t.preventActions.bind(t),!1)}),["dragenter","dragover"].forEach(function(e){t.wrapper.addEventListener(e,t.highlight.bind(t),!1)}),["dragleave","drop"].forEach(function(e){t.wrapper.addEventListener(e,t.unhighlight.bind(t),!1)}),this.wrapper.addEventListener("drop",this.handleDrop.bind(this),!1),this.el.addEventListener("change",function(){return t.addFiles(t.el.files)},!1)}},{key:"preventActions",value:function(e){e.preventDefault(),e.stopPropagation()}},{key:"highlight",value:function(){this.wrapper.classList.add("uploader__highlight")}},{key:"unhighlight",value:function(){this.wrapper.classList.remove("uploader__highlight")}},{key:"handleDrop",value:function(e){var t=e.dataTransfer.files;this.addFiles(t)}},{key:"addFiles",value:function(e){var t=!0,i=!1,n=void 0;try{for(var a,r=e[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var s=a.value,l=(window.URL.createObjectURL(s),this.files.length);this.files.push({file:s,id:o.id++}),this.files[l]=this.getFileType(this.files[l]),this.uploadFile(this.files[l]),this.previewFile(this.files[l])}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"getFileType",value:function(e){var t=e.file.type.match(/^([0-9a-z]+)\/([0-9a-z]+)/i),i=r(t,3),n=(i[0],i[1]),a=i[2];return Object.assign({},e,{type:n,ext:a})}},{key:"formatBytes",value:function(e){var t=Math.pow(2,10),i=Math.pow(2,20),n=Math.pow(2,30);return e<t?e+" Bytes":e<i?(e/t).toFixed(3)+" KB":e<n?(e/i).toFixed(3)+" MB":(e/n).toFixed(3)+" GB"}},{key:"previewFile",value:function(e){var t=this;if(e.progressBar=n('\n      <progress class="file__progress" max=100 value=0 id="progress__'+e.id+'"></progress>\n    '),e.delete=n('\n      <a class="file__delete">\n        <svg class="uploader__icon" viewBox="0 0 24 24">\n          <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" />\n        </svg>\n      </a>\n    '),e.el=n('\n      <fieldset class="uploader__file file" id="file__'+e.id+'">\n        <legend class="file__legend">'+e.file.name+'</legend>\n        <div class="file__overlay"></div>\n      </fieldset>\n    '),e.info=n('\n      <div class="file__info">\n        <span class="file__info-name">'+e.file.name+'</span>\n        <span class="file__info-size">'+this.formatBytes(e.file.size)+"</span>\n      </div>\n    "),e.delete.addEventListener("click",function(){t.deleteFile(e)}),e.el.appendChild(e.progressBar),e.el.appendChild(e.info),e.el.appendChild(e.delete),"image"===e.type){var i=new FileReader;i.readAsDataURL(e.file),i.addEventListener("load",function(){e.image=n('\n          <img class="file__image" src="'+i.result+'"/>\n        '),e.el.classList.add("file--image"),e.el.appendChild(e.image)})}this.filesWrapper.insertAdjacentElement("beforeend",e.el)}},{key:"uploadFile",value:function(t){var i=this,e=this.settings.url;if(e){var n=new XMLHttpRequest,a=new FormData;n.open("POST",e,!0),n.upload.addEventListener("progress",function(e){i.updateProgress(t.progressBar,100*e.loaded/e.total||100)}),n.addEventListener("readystatechange",function(e){4===n.readyState&&200===n.status&&i.emit("uploadSucceed",t),4===n.readyState&&200!==n.status&&i.emit("uploadFailed",t)}),a.append("file",t.file),n.send(a)}}},{key:"deleteFile",value:function(t){var i=this,e=this.settings.url;if(e){var n=new XMLHttpRequest,a=new FormData;n.open("DELETE",e+"/"+t.file.name,!0),n.addEventListener("readystatechange",function(e){4===n.readyState&&200===n.status&&i.emit("fileDeleted",t)}),t.el.remove(),this.files=this.files.filter(function(e){return e!==t}),a.append("file",t.file),n.send(a)}}},{key:"updateProgress",value:function(e,t){window.requestAnimationFrame(function(){100===(e.value=t)&&e.classList.add("file__progress--hidden")})}},{key:"on",value:function(e,t){var i=this;this.events[e]||(this.events[e]=[]);var n=this.events[e].length;return this.events[e].push(t),function(){i.events[e].splice(n,1)}}},{key:"emit",value:function(e,t){var i=this;this.events[e]&&this.events[e].length&&setTimeout(function(){i.events[e].forEach(function(e){return e(t)})},0)}}]),o}();return t.defaults={multiple:!0,url:null},t.id=0,t},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Uploader=t();